name: image

on:
  push:
    branches: [ v1alpha1 ]

env:  
  OPERATOR_IMG: "quay.io/sustainable_computing_io/kepler-operator"
  BUNDLE_IMG: "quay.io/sustainable_computing_io/kepler-operator-bundle"


jobs:
  push-image:
      name: Push operator container images to quay.io/sustainable_computing_io/
      runs-on: ubuntu-latest
      steps: 

        - name: Checkout source
          uses: actions/checkout@v3
        
        - uses: actions/setup-go@main
          with:
            go-version-file: go.mod

        - name: Login to Quay
          uses: docker/login-action@v1
          with:
            registry: quay.io/sustainable_computing_io
            username: ${{ secrets.BOT_NAME }}
            password: ${{ secrets.BOT_TOKEN }}

        - name: Build Operator Image
          run: |
            ./tests/run-e2e.sh build

        - name: Push to quay
          run: |
            ./tests/run-e2e.sh push
          
    
